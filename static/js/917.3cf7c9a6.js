"use strict";(self["webpackChunkvue3_ts_admin"]=self["webpackChunkvue3_ts_admin"]||[]).push([[917],{1084:function(e,t,n){n.d(t,{r:function(){return r},R:function(){return i}});n(7658);function o(e,t,n){for(var o=[],a=t[0],r=t[1],i=0;i<e.length;i+=2){var s=e.charCodeAt(i)-64,l=e.charCodeAt(i+1)-64;s=s>>1^-(1&s),l=l>>1^-(1&l),s+=a,l+=r,a=s,r=l,o.push([s/n,l/n])}return o}function a(e){if(!e.UTF8Encoding)return e;var t=e.UTF8Scale;null==t&&(t=1024);for(var n=e.features,a=0;a<n.length;a++)for(var r=n[a],i=r.geometry,s=i.coordinates,l=i.encodeOffsets,u=0;u<s.length;u++){var c=s[u];if("Polygon"===i.type)s[u]=o(c,l[u],t);else if("MultiPolygon"===i.type)for(var v=0;v<c.length;v++){var p=c[v];c[v]=o(p,l[u][v],t)}}return e.UTF8Encoding=!1,e}const r=async e=>new Promise(((t,n)=>{const o=new Worker("work.js");o.postMessage(e),o.onmessage=e=>{t(a(e.data)),o.terminate(),self.close()}})),i=async()=>{const e=await fetch("/source/area/china.json").then((async e=>await e.json()));return e}},3917:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});n(7658);var o=n(3396),a=n(9242),r=n(4870),i=n(3974),s=n(2482);class l{constructor(e,t){(0,s.Z)(this,"center",[0,0]),(0,s.Z)(this,"xy",[0,0]),this.center=e,this.xy=t}lngLatToXy(e,t){const n=637.1393,o=this.center[0],a=this.center[1],r=e*Math.PI/180,i=t*Math.PI/180,s=o*Math.PI/180,l=a*Math.PI/180,u=n*(r-s)*Math.cos(l),c=n*(i-l);return{x:u,y:c}}xyToLngLat(e,t){const n=637.1393,o=this.center[0],a=this.center[1],r=o*Math.PI/180,i=a*Math.PI/180,s=e/n/Math.cos(i)+r,l=t/n+i,u=180*s/Math.PI,c=180*l/Math.PI;return{lng:u,lat:c}}setCenter(e,t){e=Math.floor(1e3*e)/1e3,t=Math.floor(1e3*t)/1e3,this.center=[e,t]}}var u=l,c=n(1084),v=n(1114);const p=(e,t,n=6e3)=>{e=new v.Pa4(e.x,e.y,e.z),t=new v.Pa4(t.x,t.y,t.z);const{curve:o,mesh:a}=d(e,t,n);return{flyPoint:h(o,n),flyLine:a}},d=(e,t)=>{for(var n=new v.U7(e,t),o=n.getPoints(120),a=e.distanceTo(t)/2,r=new v.Pa4(o[40].x,o[40].y,o[40].z+a),i=new v.Pa4(o[80].x,o[80].y,o[80].z+a),s=new v.yj7(e,r,i,t),l=new v.u9r,u=s.getPoints(150),c=[],p=[],d=[],h=new v.Ilk,m=0;m<u.length;m++)h.setHSL(.31666+.005*m,.7,.7),p.push(h.r,h.g,h.b),c.push(u[m].x,u[m].y,u[m].z),d.push(m/(u.length-1));l.setAttribute("position",new v.a$l(c,3)),l.setAttribute("color",new v.a$l(p,3)),l.setAttribute("index",new v.a$l(d,1));var y=new v.nls({vertexColors:!0,transparent:!0});return{curve:s,mesh:new v.x12(l,y)}},h=(e,t)=>{var n=[],o=[],a=[];let r=e.getPoints(5e3);const i=(new v.u9r).setFromPoints(r);for(var s=0;s<r.length;s++)n.push(r[s].x,r[s].y,r[s].z),o.push(s/(r.length-1)),a.push(s);i.setAttribute("position",new v.a$l(n,3)),i.setAttribute("index",new v.a$l(o,1)),i.setAttribute("current",new v.a$l(a,1));const l=new v.jyz({uniforms:{iTime:{value:0},size:{value:t},uRange:{value:500},uTotal:{value:r.length},uColor:{value:new v.Ilk(16777215)},uColor1:{value:new v.Ilk(16711680)}},transparent:!0,depthTest:!1,side:2,vertexShader:"\n    attribute float index;\n    attribute float current;\n    uniform float size;\n    uniform vec3 uColor;\n    uniform vec3 uColor1;\n    uniform float uRange;\n    uniform float uTotal;\n    uniform float iTime;\n    varying vec3 vColor;\n    varying float vOpacity;\n    void main() {\n        // 需要当前显示的索引  \n        float showNumber = uTotal * mod(iTime/3.0, 1.0);\n        float s = size;\n        if (showNumber > current && showNumber < current + uRange) {\n            vOpacity = 1.0;\n            s *= (current + uRange - showNumber) / uRange;\n        } else {\n            vOpacity = 0.0;\n            s = 0.0;\n        }\n        // 顶点着色器计算后的Position\n        // mix 混淆颜色\n        vColor = mix(uColor, uColor1, index);\n        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n        gl_Position = projectionMatrix * mvPosition; \n        // 大小\n        gl_PointSize = s* 5.0 / (-mvPosition.z);\n    }",fragmentShader:"\n    uniform vec3 uColor;\n    uniform vec3 uColor1;\n    varying vec3 vColor; \n    varying float vOpacity; \n    void main() {\n        gl_FragColor = vec4(vColor, vOpacity);\n    }"}),u=new v.woe(i,l);return u};var m=p,y=n(3251);const w=e=>((0,o.dD)("data-v-6f11cf85"),e=e(),(0,o.Cn)(),e),f={class:"three-view"},g=w((()=>(0,o._)("div",{id:"scene-view"},null,-1))),x={class:"point-note"},z=w((()=>(0,o._)("div",{class:"trangle"},null,-1))),T={class:"info-box"},b=w((()=>(0,o._)("div",null,[(0,o._)("div",{class:"point-note-title"}),(0,o._)("div",{class:"point-note-detail"})],-1))),P=[b],B=w((()=>(0,o._)("ul",{class:"info-content"},null,-1)));var M=(0,o.aZ)({__name:"threeMap",setup(e){(0,o.RC)((()=>n.e(787).then(n.bind(n,3787))));let t,s,l,v,p,d,h,w,b,M,C,I,k=(0,r.iH)({adcode:"china-aliyun",center:[116.405285,39.904989],level:"country",postion:{x:0,y:700,z:800}}),J=(0,r.iH)({}),_=(0,r.iH)(!1),S=(0,r.iH)({}),j=new i.JB.SUY,D=((new i.JB.dpR).load("/source/human.png"),{country:{level:"country",moveY:10,position:{x:2,y:100,z:60},depth:10,scale:.5,size:400},province:{level:"province",moveY:3,position:{x:8,y:100,z:60},depth:2,scale:.1,size:100},3:{level:3,moveY:1,position:{x:8,y:50,z:60},depth:1,scale:.04,size:30}});(0,r.iH)(!0);async function L(e,n){const o=await(0,c.r)(e);if(!o)return;let a=[];const r=new i.JB.ZAu;let l=o.features||o.geometries;l.forEach(((e,o)=>{let s=e.geometry||e,l=new i.JB.ZAu,u=9999,c=9999,v=-9999,p=-9999;s.coordinates.forEach(((o,r)=>{const s=new i.JB.bnF;let d=[],h=[];o.forEach(((e,n)=>{if(Array.isArray(e[0]))e.forEach(((e,n)=>{var{x:o,y:a}=t.lngLatToXy(e[0],e[1]);0===n?s.moveTo(o,a):s.lineTo(o,a),d.push(new i.JB.Pa4(o,a,0)),h.push(o,a,0),u=u<e[0]?u:e[0],c=c<e[1]?c:e[1],v=v>e[0]?v:e[0],p=p>e[1]?p:e[1]}));else{var{x:o,y:a}=t.lngLatToXy(e[0],e[1]);0===n?s.moveTo(o,a):s.lineTo(o,a),d.push(new i.JB.Pa4(o,a,0)),h.push(o,a,0),u=u<e[0]?u:e[0],c=c<e[1]?c:e[1],v=v>e[0]?v:e[0],p=p>e[1]?p:e[1]}}));const m=O(d),f=new i.JB.HW6(s);a.push(...f.attributes.uv.array);const g={depth:-D[k.value.level].depth,bevelEnabled:!0,bevelSegments:0,steps:1,bevelSize:0,bevelThickness:0},x=new i.JB.$Vf(s,g),z=new i.JB.Kj0(x,new i.JB.jyz({uniforms:{iTime:{value:0},lightPosition:{value:w.position},color:{value:new i.JB.Ilk(16777215)},color1:{value:new i.JB.Ilk(1777760)}},side:1,vertexShader:y.C7,depthTest:!0,depthWrite:!0,fragmentShader:y.pD}));let T=e.properties.center;l.userData={...e.properties,center:T||k.value.center,adcode:e.properties.adcode||e.properties.id},l.add(z,m),z.layers.set(n),m.layers.set(n)}));let d=e.properties.center;if(d||"country"!=k.value.level){d=e.properties.center||[u+(v-u)/2,c+(p-c)/2],l.userData.center=d;let{x:a,y:r}=t.lngLatToXy(d[0],d[1]),s=(0,i.rw)({name:e.properties.name,position:{x:a,y:r,z:1}}),h=A({color:new i.JB.Ilk(16711680),position:{x:a,y:r,z:1},rotation:{x:3*Math.PI/2,y:0,z:0},time:1e3}),y=D[k.value.level].scale;if(s.scale.set(y,y,y),s.layers.set(n),h.scale.set(y,y,y),h.layers.set(n),0==o)I={x:a,y:r,z:0};else{let{flyPoint:e,flyLine:t}=m(I,{x:a,y:r,z:-1},D[k.value.level].size);e.layers.set(n),t.layers.set(n),l.add(e,t)}l.add(h,s)}l.on("click",((e,n,o)=>{k.value.adcode!=e.userData.adcode&&3!=k.value.level&&(J.value={...k.value},k.value={...e.userData},t.setCenter(e.userData.center[0],e.userData.center[1]),R())})),l.on("hover",((e,t,o)=>{new i.we.Tween(l.position).to({x:0,y:0,z:D[k.value.level].moveY},500).easing(i.we.Easing.Quadratic.Out).start(),l.traverse((e=>{"Mesh"===e.type&&e.material.uniforms&&(e.material.uniforms.color.value=new i.JB.Ilk(16777215),e.material.uniforms.color1.value=new i.JB.Ilk(30719))})),E(e.userData,n)}),((e,t,o)=>{new i.we.Tween(l.position).to({x:0,y:0,z:0},500).easing(i.we.Easing.Quadratic.In).start(),l.traverse((e=>{"Mesh"===e.type&&e.material.uniforms&&(e.material.uniforms.color.value=new i.JB.Ilk(16777215),e.material.uniforms.color1.value=new i.JB.Ilk(1777760))})),E(e.userData,n)})),r.add(l)}));let u=999,v=999,p=-999,d=-999;for(let t=0;t<a.length;t+=2){const e=a[t],n=a[t+1];u=Math.min(u,e),v=Math.min(v,n),p=Math.max(p,e),d=Math.max(d,n)}const h=p-u,f=d-v;return r.name="Group_"+k.value.level,r.traverse((e=>{if(!e.isMesh)return;let t=e.geometry.attributes.uv.array;for(let n=0;n<t.length;n+=2)t[n]=(t[n]-u)/h,t[n+1]=(t[n+1]-v)/f})),r.on("click",((e,n,o)=>{const{lng:a,lat:r}=t.xyToLngLat(o.x,-o.z)})),s.add(r),r}const A=e=>{const{color:t,time:n,position:o,rotation:a}=e,r=new i.JB.b_z(5,10,4,1,!0);let s=new i.JB.vBJ({color:t,side:1,transparent:!1,depthWrite:!0,depthTest:!0,wireframe:!1}),l=new i.JB.Kj0(r,s);l.position.copy(o),l.rotation.set(a.x,a.y,a.z);let u=new i.we.Tween(l.position).to({z:D[k.value.level].moveY},n),c=new i.we.Tween(l.position).to({z:3*D[k.value.level].moveY/2},n);u.start(),u.chain(c),c.chain(u);let v=new i.we.Tween(l.rotation).to({y:2*Math.PI},5*n),p=new i.we.Tween(l.rotation).to({y:0},5*n);return v.start(),v.chain(p),p.chain(v),l},E=(e,n)=>{if(null!==C&&s.remove(C),e.adcode==S.value.adcode&&_.value)return _.value=!1,S.value={},!1;_.value=!0,S.value=e,M.querySelector(".point-note-title").innerText=e.name,M.querySelector(".point-note-detail").innerText=e.adcode,C=new i.j8(M);const{x:o,y:a}=t.lngLatToXy(e.center[0],e.center[1]);C.position.set(o,a,0),C.layers.set(n),s.add(C)};function O(e){var t=(new i.JB.u9r).setFromPoints(e),n=new i.JB.nls({color:16777215,linewidth:1,transparent:!1,depthTest:!1,depthWrite:!1}),o=new i.JB.x12(t,n);return o}const R=async()=>{let e,t=k.value,n=0;switch(l.position.set(0,700,800),t.level){case"country":e="/source/map/",n=0;break;case"province":e="/source/map/province/",n=1;break;case 3:e="/source/map/city/",n=2;break}l.layers.set(n);let o=s.getObjectByName("Group_"+t.level);if(o&&"country"==t.level){let e=D[k.value.level].position,n=t.postion||{x:o.position.x+e.x,y:o.position.y+e.y,z:o.position.z+e.z};new i.we.Tween(l.position).to(n,500).easing(i.we.Easing.Quadratic.Out).start()}else{let a=s.getObjectByName("Group_"+k.value.level);a?.traverse((e=>{e.isCSS3DObject&&e.parent.remove(e)})),s.remove(o),o=await L(`${e}${t.adcode}.json`,n);let r=D[k.value.level].position,u=t.postion||{x:o.position.x+r.x,y:o.position.y+r.y,z:o.position.z+r.z};new i.we.Tween(l.position).to(u,500).easing(i.we.Easing.Quadratic.Out).start()}},F=()=>{if("china-aliyun"==k.value.adcode)return;let e=s.getObjectByName("Group_"+k.value.level);e?.traverse((e=>{e.isCSS3DObject&&e.parent.remove(e)})),s.remove(e),k.value={...J.value},J.value={adcode:"china-aliyun",center:[116.405285,39.904989],level:"country",postion:{x:0,y:700,z:800}},t.setCenter(k.value.center[0],k.value.center[1]),R()};return(0,o.bv)((()=>{let e=document.querySelector("#scene-view");t=new u([116.405285,39.904989],[0,0]);const n=(0,i.aY)(e,{animate:()=>{const e=j.getElapsedTime();s&&s.traverse((t=>{t.material&&t.material.uniforms&&(t.material.uniforms.iTime.value=e)}))}});s=n.scene,l=n.camera,v=n.renderer,h=n.hemLight,w=n.dirLight,b=n.controls,p=n.css2Render,d=n.css3Render,l.position.set(0,700,800),l.layers.set(0),s.rotateX(-Math.PI/2),b.minDistance=5,b.maxDistance=6371.393,b.minPolarAngle=0,b.maxPolarAngle=Math.PI/2,b.enableDamping=!0,b.dampingFactor=.3,L("/source/map/china-aliyun.json",0),window.addEventListener("dblclick",F),M=document.querySelector(".point-note")})),(0,o.Ah)((()=>{window.removeEventListener("dblclick",F),(0,i.ZH)()})),(e,t)=>((0,o.wg)(),(0,o.iD)("div",f,[g,(0,o.wy)((0,o._)("div",x,[z,(0,o._)("div",T,[(0,o._)("div",{class:"top-wrap",onClick:t[0]||(t[0]=(...t)=>e.routerInto&&e.routerInto(...t))},P),B])],512),[[a.F8,(0,r.SU)(_)]])]))}}),C=n(89);const I=(0,C.Z)(M,[["__scopeId","data-v-6f11cf85"]]);var k=I}}]);